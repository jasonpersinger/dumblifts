<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>DumbLifts ‚Äî Dumbbell 5√ó5 Tracker</title>
<meta name="description" content="Simple dumbbell 5x5 progressive overload workout tracker. Track sets, weights, and progress.">
<meta name="theme-color" content="#F17300">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="DumbLifts">
<link rel="apple-touch-icon" href="/icons/icon-192.png">
<link rel="manifest" href="/manifest.json">
<link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Source+Sans+3:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --black: #000000;
    --near-black: #070707;
    --dark-teal: #404E4D;
    --orange: #F17300;
    --gold: #7A8B8B;
    --gold-dim: rgba(122, 139, 139, 0.15);
    --gold-mid: rgba(122, 139, 139, 0.35);
    --orange-dim: rgba(241, 115, 0, 0.15);
    --text: #e8e0d0;
    --text-dim: #8a8478;
    --card-bg: #0d0d0d;
    --card-border: #1a1a1a;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Source Sans 3', sans-serif;
    background: var(--black);
    color: var(--text);
    min-height: 100vh;
    -webkit-tap-highlight-color: transparent;
  }

  /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
  .header {
    padding: 24px 20px 16px;
    text-align: center;
    border-bottom: 1px solid var(--card-border);
    position: relative;
  }
  .header svg {
    max-width: 340px;
    width: 100%;
    height: auto;
  }
  .header .subtitle {
    font-size: 0.75rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-top: 6px;
  }

  /* ‚îÄ‚îÄ Navigation Tabs ‚îÄ‚îÄ */
  .nav {
    display: flex;
    border-bottom: 1px solid var(--card-border);
  }
  .nav button {
    flex: 1;
    background: none;
    border: none;
    color: var(--text-dim);
    font-family: 'Oswald', sans-serif;
    font-size: 0.85rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 14px 0;
    cursor: pointer;
    transition: all 0.2s;
    border-bottom: 2px solid transparent;
  }
  .nav button.active {
    color: var(--gold);
    border-bottom-color: var(--gold);
  }
  .nav button:hover { color: var(--gold); }

  /* ‚îÄ‚îÄ Main Content ‚îÄ‚îÄ */
  .content { padding: 20px; max-width: 500px; margin: 0 auto; }

  /* ‚îÄ‚îÄ Workout View ‚îÄ‚îÄ */
  .workout-label {
    font-family: 'Oswald', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--gold);
    text-align: center;
    margin-bottom: 20px;
  }

  .exercise-card {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 18px;
    margin-bottom: 16px;
    transition: border-color 0.3s;
  }
  .exercise-card.all-done {
    border-color: var(--orange);
    box-shadow: 0 0 20px rgba(241, 115, 0, 0.08);
  }
  .exercise-name {
    font-family: 'Oswald', sans-serif;
    font-size: 1.15rem;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 4px;
  }
  .exercise-note {
    font-size: 0.75rem;
    color: var(--text-dim);
    margin-bottom: 14px;
    line-height: 1.4;
  }

  /* Weight control */
  .weight-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    margin-bottom: 16px;
  }
  .weight-btn {
    width: 38px;
    height: 38px;
    border-radius: 50%;
    border: 1px solid var(--gold-mid);
    background: var(--gold-dim);
    color: var(--gold);
    font-size: 1.3rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
    line-height: 1;
  }
  .weight-btn:active {
    background: var(--gold);
    color: var(--black);
    transform: scale(0.92);
  }
  .weight-display {
    font-family: 'Oswald', sans-serif;
    font-size: 1.6rem;
    font-weight: 700;
    color: var(--gold);
    min-width: 80px;
    text-align: center;
  }
  .weight-unit {
    font-size: 0.85rem;
    font-weight: 400;
    color: var(--text-dim);
    margin-left: 2px;
  }

  /* Set buttons */
  .sets-row {
    display: flex;
    gap: 8px;
    justify-content: center;
  }
  .set-btn {
    width: 52px;
    height: 52px;
    border-radius: 10px;
    border: 1px solid var(--card-border);
    background: var(--near-black);
    color: var(--text-dim);
    font-family: 'Oswald', sans-serif;
    font-size: 0.85rem;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.15s;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2px;
  }
  .set-btn .set-num { font-size: 0.65rem; opacity: 0.6; }
  .set-btn .set-reps { font-size: 1rem; font-weight: 600; }
  .set-btn.done {
    background: var(--orange);
    border-color: var(--orange);
    color: var(--black);
    box-shadow: 0 0 12px rgba(241, 115, 0, 0.25);
  }
  .set-btn:active { transform: scale(0.9); }

  /* Complete button */
  .complete-btn {
    width: 100%;
    padding: 16px;
    border: none;
    border-radius: 12px;
    font-family: 'Oswald', sans-serif;
    font-size: 1.1rem;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    margin-top: 8px;
    transition: all 0.2s;
    background: var(--card-border);
    color: var(--text-dim);
  }
  .complete-btn.ready {
    background: var(--orange);
    color: var(--black);
    box-shadow: 0 4px 20px rgba(241, 115, 0, 0.3);
  }
  .complete-btn.ready:active {
    transform: scale(0.97);
    box-shadow: 0 2px 10px rgba(241, 115, 0, 0.4);
  }

  /* ‚îÄ‚îÄ Stats View ‚îÄ‚îÄ */
  .stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 24px;
  }
  .stat-card {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 18px;
    text-align: center;
  }
  .stat-value {
    font-family: 'Oswald', sans-serif;
    font-size: 2rem;
    font-weight: 700;
    color: var(--gold);
  }
  .stat-label {
    font-size: 0.7rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-top: 4px;
  }

  /* ‚îÄ‚îÄ History View ‚îÄ‚îÄ */
  .history-item {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 10px;
    padding: 14px 16px;
    margin-bottom: 10px;
  }
  .history-date {
    font-family: 'Oswald', sans-serif;
    font-size: 0.85rem;
    color: var(--gold);
    letter-spacing: 1px;
    margin-bottom: 6px;
  }
  .history-type {
    font-family: 'Oswald', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--orange);
    margin-bottom: 8px;
  }
  .history-exercise {
    font-size: 0.82rem;
    color: var(--text-dim);
    line-height: 1.6;
  }
  .history-exercise span { color: var(--gold); font-weight: 500; }

  .empty-state {
    text-align: center;
    color: var(--text-dim);
    padding: 40px 20px;
    font-size: 0.9rem;
  }
  .empty-state .icon { font-size: 2.5rem; margin-bottom: 12px; }

  /* ‚îÄ‚îÄ Info / Program Section ‚îÄ‚îÄ */
  .info-card {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 18px;
    margin-bottom: 14px;
  }
  .info-card h3 {
    font-family: 'Oswald', sans-serif;
    font-size: 0.9rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 10px;
  }
  .info-card p, .info-card li {
    font-size: 0.82rem;
    color: var(--text-dim);
    line-height: 1.7;
  }
  .info-card ul { padding-left: 18px; }
  .info-card li { margin-bottom: 4px; }

  /* ‚îÄ‚îÄ Progress Charts ‚îÄ‚îÄ */
  .progress-chart {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 18px;
    margin-bottom: 14px;
  }
  .progress-chart h3 {
    font-family: 'Oswald', sans-serif;
    font-size: 0.9rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 14px;
  }
  .progress-chart svg {
    width: 100%;
    height: auto;
    display: block;
  }
  .chart-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: 12px;
  }
  .chart-legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.72rem;
    color: var(--text-dim);
    letter-spacing: 0.5px;
  }
  .chart-legend-swatch {
    width: 12px;
    height: 3px;
    border-radius: 2px;
    flex-shrink: 0;
  }

  /* ‚îÄ‚îÄ Hidden sections ‚îÄ‚îÄ */
  .section { display: none; }
  .section.active { display: block; }

  /* ‚îÄ‚îÄ Reset confirmation ‚îÄ‚îÄ */
  .reset-btn {
    display: block;
    margin: 30px auto 0;
    padding: 10px 24px;
    background: none;
    border: 1px solid #331111;
    border-radius: 8px;
    color: #664444;
    font-family: 'Oswald', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
  }
  .reset-btn:hover { border-color: #663333; color: #aa5555; }

  /* toast */
  .toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--gold);
    color: var(--black);
    font-family: 'Oswald', sans-serif;
    font-size: 0.9rem;
    letter-spacing: 1px;
    padding: 12px 28px;
    border-radius: 30px;
    opacity: 0;
    transition: all 0.3s ease;
    pointer-events: none;
    z-index: 100;
  }
  .toast.show {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
  }

  /* ‚îÄ‚îÄ Program Tab ‚îÄ‚îÄ */
  .program-card {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 18px;
    margin-bottom: 14px;
  }
  .program-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    font-family: 'Oswald', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gold);
  }
  .program-action-btn {
    background: var(--gold-dim);
    border: 1px solid var(--gold-mid);
    color: var(--gold);
    font-family: 'Oswald', sans-serif;
    font-size: 0.7rem;
    letter-spacing: 1px;
    text-transform: uppercase;
    padding: 5px 12px;
    border-radius: 6px;
    cursor: pointer;
    margin-left: 6px;
    transition: all 0.15s;
  }
  .program-action-btn:active {
    background: var(--gold);
    color: var(--black);
  }
  .program-action-btn.remove {
    border-color: #331111;
    color: #664444;
    background: none;
  }
  .program-action-btn.remove:active {
    background: #664444;
    color: var(--black);
  }
  .program-card-exercise {
    font-size: 0.85rem;
    color: var(--text-dim);
    padding: 4px 0;
    display: flex;
    justify-content: space-between;
  }
  .program-card-exercise span {
    color: var(--gold);
    font-weight: 500;
  }
  .balance-check .balance-badges {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }
  .balance-ok {
    color: #5a9a5a;
    font-family: 'Oswald', sans-serif;
    font-size: 0.85rem;
    letter-spacing: 1px;
  }
  .balance-warn {
    color: var(--orange);
    font-family: 'Oswald', sans-serif;
    font-size: 0.85rem;
    letter-spacing: 1px;
  }
  .balance-warning-text {
    margin-top: 8px;
    color: var(--orange) !important;
    font-size: 0.78rem !important;
  }
  .add-workout-btn {
    width: 100%;
    padding: 14px;
    border: 1px dashed var(--card-border);
    border-radius: 12px;
    background: none;
    color: var(--text-dim);
    font-family: 'Oswald', sans-serif;
    font-size: 0.9rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    margin-bottom: 14px;
    transition: all 0.2s;
  }
  .add-workout-btn:hover {
    border-color: var(--gold-mid);
    color: var(--gold);
  }
  .cancel-btn {
    border-style: solid;
    border-color: #331111;
    color: #664444;
  }
  .reference-divider {
    text-align: center;
    font-family: 'Oswald', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--text-dim);
    margin: 24px 0 16px;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .reference-divider::before, .reference-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--card-border);
  }

  /* ‚îÄ‚îÄ Edit Workout Sub-View ‚îÄ‚îÄ */
  .edit-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
    font-family: 'Oswald', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gold);
  }
  .edit-back-btn {
    background: none;
    border: none;
    color: var(--gold);
    font-family: 'Oswald', sans-serif;
    font-size: 0.85rem;
    letter-spacing: 1px;
    cursor: pointer;
    padding: 4px 0;
  }
  .edit-section-label {
    font-family: 'Oswald', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-bottom: 8px;
  }
  .edit-selected {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 8px;
    margin-bottom: 20px;
  }
  .edit-selected-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    font-size: 0.85rem;
    color: var(--text);
  }
  .edit-remove-btn {
    background: none;
    border: none;
    color: #664444;
    font-size: 1.1rem;
    cursor: pointer;
    padding: 2px 6px;
  }
  .exercise-group-header {
    font-family: 'Oswald', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-dim);
    margin: 16px 0 8px;
  }
  .exercise-option {
    display: block;
    width: 100%;
    text-align: left;
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 8px;
    padding: 12px 14px;
    margin-bottom: 6px;
    color: var(--text);
    font-size: 0.85rem;
    font-family: 'Source Sans 3', sans-serif;
    cursor: pointer;
    transition: all 0.15s;
  }
  .exercise-option:active {
    transform: scale(0.98);
  }
  .exercise-option.selected {
    border-color: var(--orange);
    color: var(--orange);
    background: var(--orange-dim);
  }
</style>
</head>
<body>

<div class="header">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 730 160">
    <rect x="62" y="68" width="70" height="14" rx="7" fill="#F17300"/>
    <rect x="34" y="42" width="36" height="66" rx="7" fill="#F17300"/>
    <rect x="14" y="50" width="28" height="50" rx="5" fill="#F17300"/>
    <rect x="124" y="42" width="36" height="66" rx="7" fill="#F17300"/>
    <rect x="152" y="50" width="28" height="50" rx="5" fill="#F17300"/>
    <rect x="208" y="36" width="4" height="78" rx="2" fill="#F17300" opacity="0.4"/>
    <text x="240" y="110" font-family="Oswald, sans-serif" font-weight="700" font-size="78" fill="#F17300" letter-spacing="8">DUMBLIFTS</text>
  </svg>
  <div class="subtitle">Dumbbell 5√ó5 Program</div>
</div>

<div class="nav">
  <button class="active" onclick="showSection('workout')">Workout</button>
  <button onclick="showSection('history')">History</button>
  <button onclick="showSection('stats')">Stats</button>
  <button onclick="showSection('program')">Program</button>
</div>

<div class="content">
  <!-- WORKOUT -->
  <div id="sec-workout" class="section active"></div>

  <!-- HISTORY -->
  <div id="sec-history" class="section"></div>

  <!-- STATS -->
  <div id="sec-stats" class="section"></div>

  <!-- PROGRAM -->
  <div id="sec-program" class="section"></div>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚îÄ‚îÄ Exercise Library ‚îÄ‚îÄ
const EXERCISE_LIBRARY = [
  // Legs
  { id: 'goblet_squat', name: 'Goblet Squat', note: 'One DB at chest, squat deep', group: 'legs', defaultWeight: 30, unit: 'lb' },
  { id: 'db_rdl', name: 'DB Romanian Deadlift', note: 'Hinge at hips, slight knee bend', group: 'legs', defaultWeight: 30, unit: 'lb ea.' },
  { id: 'db_lunge', name: 'DB Lunge', note: 'Step forward, lower back knee', group: 'legs', defaultWeight: 20, unit: 'lb ea.' },
  { id: 'db_bulgarian', name: 'DB Bulgarian Split Squat', note: 'Rear foot elevated, squat down', group: 'legs', defaultWeight: 20, unit: 'lb ea.' },
  { id: 'db_stepup', name: 'DB Step-Up', note: 'Step onto bench, drive up', group: 'legs', defaultWeight: 20, unit: 'lb ea.' },
  { id: 'db_sumo', name: 'DB Sumo Squat', note: 'Wide stance, DB hangs between legs', group: 'legs', defaultWeight: 30, unit: 'lb' },
  // Push
  { id: 'db_bench', name: 'DB Bench Press', note: 'Flat bench, press up', group: 'push', defaultWeight: 20, unit: 'lb ea.' },
  { id: 'db_floor', name: 'DB Floor Press', note: 'Lie on floor, press up', group: 'push', defaultWeight: 20, unit: 'lb ea.' },
  { id: 'db_ohp', name: 'DB Overhead Press', note: 'Standing, press straight up', group: 'push', defaultWeight: 15, unit: 'lb ea.' },
  { id: 'db_incline', name: 'DB Incline Press', note: 'Incline bench, press up at angle', group: 'push', defaultWeight: 20, unit: 'lb ea.' },
  { id: 'db_arnold', name: 'DB Arnold Press', note: 'Rotate palms as you press up', group: 'push', defaultWeight: 15, unit: 'lb ea.' },
  { id: 'db_lateral', name: 'DB Lateral Raise', note: 'Raise out to sides, slight bend', group: 'push', defaultWeight: 10, unit: 'lb ea.' },
  // Pull
  { id: 'db_row', name: 'DB Row', note: 'Bent-over, pull to hip', group: 'pull', defaultWeight: 20, unit: 'lb ea.' },
  { id: 'db_reverse_fly', name: 'DB Reverse Fly', note: 'Bent-over, fly out to sides', group: 'pull', defaultWeight: 10, unit: 'lb ea.' },
  { id: 'db_shrug', name: 'DB Shrug', note: 'Shrug shoulders up, hold at top', group: 'pull', defaultWeight: 25, unit: 'lb ea.' },
  { id: 'db_pullover', name: 'DB Pullover', note: 'Lie on bench, arc DB over head', group: 'pull', defaultWeight: 20, unit: 'lb' },
  { id: 'db_curl', name: 'DB Curl', note: 'Curl up, squeeze at top', group: 'pull', defaultWeight: 15, unit: 'lb ea.' },
  { id: 'db_hammer', name: 'DB Hammer Curl', note: 'Neutral grip, curl up', group: 'pull', defaultWeight: 15, unit: 'lb ea.' }
];

const DEFAULT_PROGRAM = [
  { id: 'A', label: 'Workout A', exerciseIds: ['goblet_squat', 'db_bench', 'db_row'] },
  { id: 'B', label: 'Workout B', exerciseIds: ['db_rdl', 'db_ohp', 'db_floor'] }
];

// ‚îÄ‚îÄ Derived WORKOUTS (rebuilt from state.program + library) ‚îÄ‚îÄ
let WORKOUTS = {};

function buildWorkouts() {
  WORKOUTS = {};
  state.program.forEach(pw => {
    WORKOUTS[pw.id] = {
      label: pw.label,
      exercises: pw.exerciseIds.map(eid => {
        const lib = EXERCISE_LIBRARY.find(e => e.id === eid);
        return lib ? { id: lib.id, name: lib.name, note: lib.note, defaultWeight: lib.defaultWeight, unit: lib.unit } : null;
      }).filter(Boolean)
    };
  });
}

// ‚îÄ‚îÄ State ‚îÄ‚îÄ
function defaultState() {
  const program = JSON.parse(JSON.stringify(DEFAULT_PROGRAM));
  const weights = {};
  program.forEach(pw => {
    pw.exerciseIds.forEach(eid => {
      const lib = EXERCISE_LIBRARY.find(e => e.id === eid);
      if (lib) weights[eid] = lib.defaultWeight;
    });
  });
  return {
    nextWorkout: 'A',
    weights,
    currentSets: {},
    history: [],
    totalWorkouts: 0,
    program
  };
}

function loadState() {
  try {
    const s = localStorage.getItem('dumblifts');
    if (s) {
      const parsed = JSON.parse(s);
      // Migration: add program if missing (existing users)
      if (!parsed.program) {
        parsed.program = JSON.parse(JSON.stringify(DEFAULT_PROGRAM));
      }
      return parsed;
    }
  } catch(e) {}
  return defaultState();
}

let state = loadState();
buildWorkouts();

function saveState() {
  localStorage.setItem('dumblifts', JSON.stringify(state));
}

// ‚îÄ‚îÄ Edit Workout State ‚îÄ‚îÄ
let editingWorkoutIdx = null;
let editNewWorkoutId = null;
let editSelectedIds = [];

// ‚îÄ‚îÄ Render ‚îÄ‚îÄ
function renderWorkout() {
  const sec = document.getElementById('sec-workout');
  const wo = WORKOUTS[state.nextWorkout];

  if (!wo) {
    sec.innerHTML = '<div class="empty-state">No workout found. Check your program settings.</div>';
    return;
  }

  // Init current sets if needed
  wo.exercises.forEach(ex => {
    if (!state.currentSets[ex.id] || state.currentSets[ex.id].length !== 5) {
      state.currentSets[ex.id] = [false, false, false, false, false];
    }
  });

  let html = `<div class="workout-label">${wo.label}</div>`;

  wo.exercises.forEach(ex => {
    const sets = state.currentSets[ex.id];
    const allDone = sets.every(Boolean);
    html += `
      <div class="exercise-card ${allDone ? 'all-done' : ''}">
        <div class="exercise-name">${ex.name}</div>
        <div class="exercise-note">${ex.note}</div>
        <div class="weight-row">
          <button class="weight-btn" onclick="changeWeight('${ex.id}', -5)">‚àí</button>
          <div class="weight-display">${state.weights[ex.id]}<span class="weight-unit">${ex.unit}</span></div>
          <button class="weight-btn" onclick="changeWeight('${ex.id}', 5)">+</button>
        </div>
        <div class="sets-row">
          ${sets.map((done, i) => `
            <button class="set-btn ${done ? 'done' : ''}" onclick="toggleSet('${ex.id}', ${i})">
              <span class="set-num">S${i+1}</span>
              <span class="set-reps">√ó5</span>
            </button>
          `).join('')}
        </div>
      </div>`;
  });

  const allComplete = wo.exercises.every(ex => state.currentSets[ex.id].every(Boolean));
  html += `<button class="complete-btn ${allComplete ? 'ready' : ''}"
    onclick="${allComplete ? 'completeWorkout()' : ''}"
    ${allComplete ? '' : 'disabled'}>
    ${allComplete ? 'Complete Workout ‚úì' : 'Finish All Sets'}
  </button>`;

  sec.innerHTML = html;
}

function renderHistory() {
  const sec = document.getElementById('sec-history');
  if (!state.history.length) {
    sec.innerHTML = `<div class="empty-state"><div class="icon">üèãÔ∏è</div>No workouts yet. Go lift something.</div>`;
    return;
  }
  let html = '';
  state.history.slice().reverse().slice(0, 20).forEach(entry => {
    html += `<div class="history-item">
      <div class="history-date">${entry.date}</div>
      <div class="history-type">${entry.type}</div>
      <div class="history-exercise">
        ${entry.exercises.map(e => `${e.name}: <span>${e.weight} ${e.unit}</span>`).join('<br>')}
      </div>
    </div>`;
  });
  sec.innerHTML = html;
}

function renderProgressChart(workoutLabel, exercises, colors, history) {
  const entries = history.filter(h => h.type === workoutLabel);
  if (entries.length < 2) return '';

  const pad = { top: 16, right: 16, bottom: 28, left: 38 };
  const W = 400, H = 180;
  const plotW = W - pad.left - pad.right;
  const plotH = H - pad.top - pad.bottom;

  // Build per-exercise data series: [{name, color, points: [{x, y}]}]
  const series = exercises.map((ex, i) => {
    const points = entries.map((entry, idx) => {
      const found = entry.exercises.find(e => e.name === ex.name);
      return { x: idx, y: found ? found.weight : null };
    }).filter(p => p.y !== null);
    return { name: ex.name, color: colors[i], points };
  });

  // Compute Y range across all series
  let allY = [];
  series.forEach(s => s.points.forEach(p => allY.push(p.y)));
  if (!allY.length) return '';
  let minY = Math.min(...allY);
  let maxY = Math.max(...allY);
  if (minY === maxY) { minY -= 5; maxY += 5; }
  const yPad = (maxY - minY) * 0.15;
  minY = Math.floor((minY - yPad) / 5) * 5;
  maxY = Math.ceil((maxY + yPad) / 5) * 5;
  if (minY < 0) minY = 0;

  const n = entries.length;
  const scaleX = (idx) => pad.left + (n === 1 ? plotW / 2 : (idx / (n - 1)) * plotW);
  const scaleY = (val) => pad.top + plotH - ((val - minY) / (maxY - minY)) * plotH;

  // Grid lines (horizontal)
  const gridSteps = 4;
  let gridSvg = '';
  for (let i = 0; i <= gridSteps; i++) {
    const val = minY + (maxY - minY) * (i / gridSteps);
    const y = scaleY(val);
    gridSvg += `<line x1="${pad.left}" y1="${y}" x2="${W - pad.right}" y2="${y}" stroke="#1a1a1a" stroke-width="1"/>`;
    gridSvg += `<text x="${pad.left - 6}" y="${y + 3.5}" text-anchor="end" fill="#8a8478" font-size="10" font-family="Oswald, sans-serif">${Math.round(val)}</text>`;
  }

  // X axis labels (dates)
  let xLabelSvg = '';
  const labelIndices = new Set([0, n - 1]);
  if (n > 4) labelIndices.add(Math.floor(n / 2));
  if (n > 8) { labelIndices.add(Math.floor(n / 4)); labelIndices.add(Math.floor(3 * n / 4)); }
  labelIndices.forEach(idx => {
    const x = scaleX(idx);
    const raw = entries[idx].date;
    const parts = raw.split(', ');
    const short = parts.length >= 2 ? parts[1].replace(/,.*/, '') : raw;
    xLabelSvg += `<text x="${x}" y="${H - 4}" text-anchor="middle" fill="#8a8478" font-size="9" font-family="Oswald, sans-serif">${short}</text>`;
  });

  // Lines + dots
  let linesSvg = '';
  series.forEach(s => {
    if (s.points.length < 2) return;
    const polyPoints = s.points.map(p => `${scaleX(p.x).toFixed(1)},${scaleY(p.y).toFixed(1)}`).join(' ');
    linesSvg += `<polyline points="${polyPoints}" fill="none" stroke="${s.color}" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>`;
    s.points.forEach(p => {
      linesSvg += `<circle cx="${scaleX(p.x).toFixed(1)}" cy="${scaleY(p.y).toFixed(1)}" r="3" fill="${s.color}"/>`;
    });
  });

  // Legend
  const legendHtml = series.map(s =>
    `<div class="chart-legend-item"><span class="chart-legend-swatch" style="background:${s.color}"></span>${s.name}</div>`
  ).join('');

  return `
    <div class="progress-chart">
      <h3>${workoutLabel} Progress</h3>
      <svg viewBox="0 0 ${W} ${H}" preserveAspectRatio="xMidYMid meet">
        ${gridSvg}
        ${xLabelSvg}
        ${linesSvg}
      </svg>
      <div class="chart-legend">${legendHtml}</div>
    </div>`;
}

function renderStats() {
  const sec = document.getElementById('sec-stats');
  const weekNum = Math.floor(state.totalWorkouts / 3) + 1;

  // Dynamic workout counts
  let countHtml = '';
  state.program.forEach(pw => {
    const count = state.history.filter(h => h.type === pw.label).length;
    countHtml += `<div class="stat-card">
      <div class="stat-value">${count}</div>
      <div class="stat-label">${pw.label}</div>
    </div>`;
  });

  // Current weights
  let maxHtml = '';
  Object.values(WORKOUTS).forEach(w => {
    w.exercises.forEach(ex => {
      maxHtml += `<div class="history-exercise" style="padding:4px 0;">${ex.name}: <span style="color:var(--gold);font-weight:600;">${state.weights[ex.id]} ${ex.unit}</span></div>`;
    });
  });

  // Progress charts ‚Äî warm tones for even index, cool for odd
  const colorSets = [
    ['#F17300', '#E8943A', '#D4A55A'],
    ['#7A8B8B', '#5E9BA8', '#8BAAB5'],
    ['#F17300', '#E8943A', '#D4A55A'],
    ['#7A8B8B', '#5E9BA8', '#8BAAB5']
  ];
  let chartsHtml = '';
  state.program.forEach((pw, idx) => {
    const wo = WORKOUTS[pw.id];
    if (wo) {
      chartsHtml += renderProgressChart(pw.label, wo.exercises, colorSets[idx % colorSets.length], state.history);
    }
  });

  sec.innerHTML = `
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value">${state.totalWorkouts}</div>
        <div class="stat-label">Total Workouts</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">${weekNum}</div>
        <div class="stat-label">Current Week</div>
      </div>
      ${countHtml}
    </div>
    <div class="info-card">
      <h3>Current Weights</h3>
      ${maxHtml}
    </div>
    ${chartsHtml}`;
}

// ‚îÄ‚îÄ Program Tab ‚îÄ‚îÄ
function renderProgram() {
  const sec = document.getElementById('sec-program');

  let html = '<div class="workout-label">Your Program</div>';

  // Workout cards
  state.program.forEach((pw, idx) => {
    const wo = WORKOUTS[pw.id];
    html += `<div class="program-card">
      <div class="program-card-header">
        <span>${pw.label}</span>
        <div>
          <button class="program-action-btn" onclick="editWorkout(${idx})">Edit</button>
          ${state.program.length > 2 ? `<button class="program-action-btn remove" onclick="removeWorkout(${idx})">√ó</button>` : ''}
        </div>
      </div>`;
    if (wo) {
      wo.exercises.forEach(ex => {
        html += `<div class="program-card-exercise"><span style="color:var(--text-dim);font-weight:400;">${ex.name}</span> <span>${state.weights[ex.id]} ${ex.unit}</span></div>`;
      });
    }
    html += '</div>';
  });

  // Add workout button
  if (state.program.length < 4) {
    html += `<button class="add-workout-btn" onclick="addWorkout()">+ Add Workout</button>`;
  }

  // Balance check
  const allExerciseIds = new Set();
  state.program.forEach(pw => pw.exerciseIds.forEach(id => allExerciseIds.add(id)));
  const groups = new Set();
  allExerciseIds.forEach(id => {
    const lib = EXERCISE_LIBRARY.find(e => e.id === id);
    if (lib) groups.add(lib.group);
  });
  const hasLegs = groups.has('legs');
  const hasPush = groups.has('push');
  const hasPull = groups.has('pull');

  html += `<div class="info-card balance-check">
    <h3>Balance Check</h3>
    <div class="balance-badges">
      <span class="${hasPush ? 'balance-ok' : 'balance-warn'}">${hasPush ? '‚úì' : '‚úó'} Push</span>
      <span class="${hasPull ? 'balance-ok' : 'balance-warn'}">${hasPull ? '‚úì' : '‚úó'} Pull</span>
      <span class="${hasLegs ? 'balance-ok' : 'balance-warn'}">${hasLegs ? '‚úì' : '‚úó'} Legs</span>
    </div>
    ${(!hasLegs || !hasPush || !hasPull) ? '<p class="balance-warning-text">Your program is missing muscle groups. Consider adding exercises for balanced development.</p>' : ''}
  </div>`;

  // Presets
  html += `<div class="info-card">
    <h3>Presets</h3>
    <button class="add-workout-btn" onclick="restoreDefault()" style="margin-top:0;">Restore Default</button>
  </div>`;

  // Reference divider
  html += '<div class="reference-divider">Reference</div>';

  // Info cards
  html += `
    <div class="info-card">
      <h3>Schedule</h3>
      <p>3 days per week, alternating workouts. Rest at least one day between sessions.</p>
    </div>
    <div class="info-card">
      <h3>Progression</h3>
      <p>With fixed dumbbells (5 lb jumps per dumbbell), stay at your current weight until 5√ó5 feels solid ‚Äî even hitting 5√ó6 or 5√ó7. Then jump to the next dumbbell. You might only get 5√ó3 at the new weight ‚Äî that's fine. Build back to 5√ó5 over a few sessions.</p>
    </div>
    <div class="info-card">
      <h3>Rest Between Sets</h3>
      <p>90 seconds when weights are light. 3‚Äì5 minutes as they get heavy. No rush.</p>
    </div>
    <div class="info-card">
      <h3>Warmup</h3>
      <p>Before each exercise: 1√ó5 with very light weight, then 1√ó5 at ~50% of your working weight. Then hit your 5 working sets.</p>
    </div>
    <div class="info-card">
      <h3>Exercise Tips</h3>
      <ul>
        <li><strong>Goblet Squat</strong> ‚Äî Hold one DB vertically at your chest. Squat deep.</li>
        <li><strong>DB Bench Press</strong> ‚Äî Flat bench, press DBs up together.</li>
        <li><strong>DB Row</strong> ‚Äî Bent-over, one arm at a time or both. Pull to hip.</li>
        <li><strong>DB Romanian Deadlift</strong> ‚Äî Slight knee bend, hinge at hips, feel the hamstrings.</li>
        <li><strong>DB Overhead Press</strong> ‚Äî Standing or seated. Press straight up.</li>
        <li><strong>DB Floor Press</strong> ‚Äî Lie on the floor, press up. Tricep-focused bench variant.</li>
      </ul>
    </div>
    <div class="info-card">
      <h3>Deload Protocol</h3>
      <p>If you fail to get 5√ó5 at a weight for 3 consecutive sessions, drop down 10% and build back up. This is normal and part of the process.</p>
    </div>`;

  html += '<button class="reset-btn" onclick="resetAll()">Reset All Data</button>';

  sec.innerHTML = html;
}

// ‚îÄ‚îÄ Edit Workout Sub-View ‚îÄ‚îÄ
function renderEditWorkout() {
  const sec = document.getElementById('sec-program');
  const isNew = editNewWorkoutId !== null;
  const label = isNew ? 'Workout ' + editNewWorkoutId : state.program[editingWorkoutIdx].label;

  let html = `<div class="edit-header">
    <button class="edit-back-btn" onclick="cancelEdit()">‚Üê Back</button>
    <span>${isNew ? 'New' : 'Edit'} ${label}</span>
  </div>`;

  // Selected exercises
  html += `<div class="edit-section-label">Selected (${editSelectedIds.length}/3)</div>`;
  if (editSelectedIds.length > 0) {
    html += '<div class="edit-selected">';
    editSelectedIds.forEach(eid => {
      const lib = EXERCISE_LIBRARY.find(e => e.id === eid);
      if (lib) {
        html += `<div class="edit-selected-item">
          <span>${lib.name}</span>
          <button class="edit-remove-btn" onclick="editToggleExercise('${eid}')">√ó</button>
        </div>`;
      }
    });
    html += '</div>';
  }

  // Exercise library by group
  const groupOrder = ['legs', 'push', 'pull'];
  const groupLabels = { legs: 'Legs', push: 'Push', pull: 'Pull' };

  groupOrder.forEach(group => {
    html += `<div class="exercise-group-header">${groupLabels[group]}</div>`;
    EXERCISE_LIBRARY.filter(e => e.group === group).forEach(ex => {
      const selected = editSelectedIds.includes(ex.id);
      html += `<button class="exercise-option ${selected ? 'selected' : ''}" onclick="editToggleExercise('${ex.id}')">
        ${ex.name}${selected ? ' ‚úì' : ''}
      </button>`;
    });
  });

  // Save / Cancel
  const canSave = editSelectedIds.length === 3;
  html += `<button class="complete-btn ${canSave ? 'ready' : ''}" onclick="${canSave ? 'saveEditWorkout()' : ''}" ${canSave ? '' : 'disabled'} style="margin-top:20px;">
    ${canSave ? 'Save Workout' : 'Select 3 Exercises'}
  </button>`;
  html += `<button class="add-workout-btn cancel-btn" onclick="cancelEdit()" style="margin-top:10px;">Cancel</button>`;

  sec.innerHTML = html;
}

// ‚îÄ‚îÄ Actions ‚îÄ‚îÄ
function toggleSet(exId, setIndex) {
  state.currentSets[exId][setIndex] = !state.currentSets[exId][setIndex];
  saveState();
  renderWorkout();
}

function changeWeight(exId, delta) {
  state.weights[exId] = Math.max(5, state.weights[exId] + delta);
  saveState();
  renderWorkout();
}

function completeWorkout() {
  const wo = WORKOUTS[state.nextWorkout];
  const entry = {
    date: new Date().toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' }),
    type: wo.label,
    exercises: wo.exercises.map(ex => ({
      name: ex.name,
      weight: state.weights[ex.id],
      unit: ex.unit
    }))
  };
  state.history.push(entry);
  state.totalWorkouts++;

  // Reset sets
  wo.exercises.forEach(ex => {
    state.currentSets[ex.id] = [false, false, false, false, false];
  });

  // Cycle to next workout
  const ids = state.program.map(p => p.id);
  const curIdx = ids.indexOf(state.nextWorkout);
  state.nextWorkout = ids[(curIdx + 1) % ids.length];

  saveState();
  renderWorkout();
  showToast('Workout logged! üí™');
}

function resetAll() {
  if (confirm('Reset all DumbLifts data? This clears your history, weights, and progress.')) {
    state = defaultState();
    buildWorkouts();
    saveState();
    renderWorkout();
    renderHistory();
    renderStats();
    showToast('Data reset');
  }
}

// ‚îÄ‚îÄ Program Actions ‚îÄ‚îÄ
function editWorkout(idx) {
  editingWorkoutIdx = idx;
  editNewWorkoutId = null;
  editSelectedIds = [...state.program[idx].exerciseIds];
  renderEditWorkout();
}

function addWorkout() {
  const usedIds = state.program.map(p => p.id);
  const nextId = ['A', 'B', 'C', 'D'].find(id => !usedIds.includes(id));
  if (!nextId) return;

  editingWorkoutIdx = state.program.length;
  editNewWorkoutId = nextId;
  editSelectedIds = [];
  renderEditWorkout();
}

function editToggleExercise(eid) {
  const idx = editSelectedIds.indexOf(eid);
  if (idx >= 0) {
    editSelectedIds.splice(idx, 1);
  } else if (editSelectedIds.length < 3) {
    editSelectedIds.push(eid);
  }
  renderEditWorkout();
}

function saveEditWorkout() {
  if (editSelectedIds.length !== 3) return;

  if (editNewWorkoutId) {
    // Adding new workout
    state.program.push({
      id: editNewWorkoutId,
      label: 'Workout ' + editNewWorkoutId,
      exerciseIds: [...editSelectedIds]
    });
  } else {
    // Editing existing
    state.program[editingWorkoutIdx].exerciseIds = [...editSelectedIds];
  }

  // Init weights for new exercises
  editSelectedIds.forEach(eid => {
    if (state.weights[eid] === undefined) {
      const lib = EXERCISE_LIBRARY.find(e => e.id === eid);
      if (lib) state.weights[eid] = lib.defaultWeight;
    }
  });

  // Clear currentSets for this workout's exercises
  editSelectedIds.forEach(eid => {
    state.currentSets[eid] = [false, false, false, false, false];
  });

  buildWorkouts();
  saveState();
  editingWorkoutIdx = null;
  editNewWorkoutId = null;
  editSelectedIds = [];
  renderProgram();
}

function cancelEdit() {
  editingWorkoutIdx = null;
  editNewWorkoutId = null;
  editSelectedIds = [];
  renderProgram();
}

function removeWorkout(idx) {
  if (state.program.length <= 2) return;
  const pw = state.program[idx];
  if (!confirm(`Remove ${pw.label}? This cannot be undone.`)) return;

  state.program.splice(idx, 1);

  // Clean up currentSets for orphaned exercises
  const usedIds = new Set();
  state.program.forEach(p => p.exerciseIds.forEach(id => usedIds.add(id)));
  Object.keys(state.currentSets).forEach(id => {
    if (!usedIds.has(id)) delete state.currentSets[id];
  });

  // Fix nextWorkout if it was the removed workout
  const ids = state.program.map(p => p.id);
  if (!ids.includes(state.nextWorkout)) {
    state.nextWorkout = ids[0];
  }

  buildWorkouts();
  saveState();
  renderProgram();
}

function restoreDefault() {
  if (!confirm('Restore default A/B program? This resets your workout configuration but keeps your history.')) return;

  state.program = JSON.parse(JSON.stringify(DEFAULT_PROGRAM));

  // Re-init weights from defaults
  state.program.forEach(pw => {
    pw.exerciseIds.forEach(eid => {
      const lib = EXERCISE_LIBRARY.find(e => e.id === eid);
      if (lib) state.weights[eid] = lib.defaultWeight;
    });
  });

  state.currentSets = {};
  state.nextWorkout = 'A';

  buildWorkouts();
  saveState();
  renderProgram();
  showToast('Default program restored');
}

// ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ
function showSection(name) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(`sec-${name}`).classList.add('active');
  document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
  event.currentTarget.classList.add('active');

  if (name === 'workout') renderWorkout();
  if (name === 'history') renderHistory();
  if (name === 'stats') renderStats();
  if (name === 'program') renderProgram();
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2200);
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
renderWorkout();

// ‚îÄ‚îÄ Register Service Worker ‚îÄ‚îÄ
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js')
    .then(reg => console.log('SW registered:', reg.scope))
    .catch(err => console.log('SW registration failed:', err));
}
</script>
</body>
</html>
