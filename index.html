<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>DUMBLIFTS: Dumbbell 5√ó5 Strength Tracker</title>
<meta name="description" content="Free dumbbell 5√ó5 workout tracker. Log sets, track progressive overload, and build strength with a simple push/pull/legs program. Works offline. No account required.">
<meta name="keywords" content="dumbbell workout tracker, 5x5 program, strength training, progressive overload, dumbbell 5x5, workout log, push pull legs, gym tracker">
<link rel="canonical" href="https://dumblifts.com/">

<!-- Open Graph -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://dumblifts.com/">
<meta property="og:title" content="DUMBLIFTS: Dumbbell 5√ó5 Strength Tracker">
<meta property="og:description" content="Free dumbbell 5√ó5 workout tracker. Log sets, track progressive overload, and build strength. Works offline.">
<meta property="og:image" content="https://dumblifts.com/icons/icon-512.png">
<meta property="og:site_name" content="DumbLifts">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@dumbliftsdotcom">
<meta name="twitter:title" content="DUMBLIFTS: Dumbbell 5√ó5 Strength Tracker">
<meta name="twitter:description" content="Free dumbbell 5√ó5 workout tracker. Log sets, track progressive overload, and build strength. Works offline.">
<meta name="twitter:image" content="https://dumblifts.com/icons/icon-512.png">

<meta name="theme-color" content="#F17300">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="DumbLifts">
<link rel="apple-touch-icon" href="/icons/icon-192.png">
<link rel="manifest" href="/manifest.json">
<link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">

<!-- Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "DumbLifts",
  "url": "https://dumblifts.com",
  "description": "Free dumbbell 5√ó5 workout tracker with progressive overload, push/pull/legs programming, and cloud sync.",
  "applicationCategory": "HealthApplication",
  "operatingSystem": "Any",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
  "image": "https://dumblifts.com/icons/icon-512.png"
}
</script>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Source+Sans+3:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --black: #000000;
    --near-black: #070707;
    --dark-teal: #404E4D;
    --orange: #F17300;
    --gold: #7A8B8B;
    --gold-dim: rgba(122, 139, 139, 0.15);
    --gold-mid: rgba(122, 139, 139, 0.35);
    --orange-dim: rgba(241, 115, 0, 0.15);
    --text: #e8e0d0;
    --text-dim: #8a8478;
    --card-bg: #0d0d0d;
    --card-border: #1a1a1a;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Source Sans 3', sans-serif;
    background: var(--black);
    color: var(--text);
    min-height: 100vh;
    -webkit-tap-highlight-color: transparent;
  }

  /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
  .header {
    padding: 24px 20px 16px;
    text-align: center;
    border-bottom: 1px solid var(--card-border);
    position: relative;
  }
  .header svg {
    max-width: 340px;
    width: 100%;
    height: auto;
  }
  .header .subtitle {
    font-size: 0.95rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: #ffffff;
    margin-top: 6px;
  }

  /* ‚îÄ‚îÄ Navigation Tabs ‚îÄ‚îÄ */
  .nav {
    display: flex;
    border-bottom: 1px solid var(--card-border);
  }
  .nav button {
    flex: 1;
    background: none;
    border: none;
    color: var(--text-dim);
    font-family: 'Oswald', sans-serif;
    font-size: 0.85rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 14px 0;
    cursor: pointer;
    transition: all 0.2s;
    border-bottom: 2px solid transparent;
  }
  .nav button.active {
    color: var(--gold);
    border-bottom-color: var(--gold);
  }
  .nav button:hover { color: var(--gold); }

  /* ‚îÄ‚îÄ Main Content ‚îÄ‚îÄ */
  .content { padding: 20px; max-width: 500px; margin: 0 auto; }

  /* ‚îÄ‚îÄ Workout View ‚îÄ‚îÄ */
  .workout-label {
    font-family: 'Oswald', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--gold);
    text-align: center;
    margin-bottom: 20px;
  }

  .exercise-card {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 18px;
    margin-bottom: 16px;
    transition: border-color 0.3s;
  }
  .exercise-card.all-done {
    border-color: var(--orange);
    box-shadow: 0 0 20px rgba(241, 115, 0, 0.08);
  }
  .exercise-name {
    font-family: 'Oswald', sans-serif;
    font-size: 1.15rem;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 4px;
  }
  .exercise-note {
    font-size: 0.75rem;
    color: var(--text-dim);
    margin-bottom: 14px;
    line-height: 1.4;
  }

  /* Weight control */
  .weight-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    margin-bottom: 16px;
  }
  .weight-btn {
    width: 38px;
    height: 38px;
    border-radius: 50%;
    border: 1px solid var(--gold-mid);
    background: var(--gold-dim);
    color: var(--gold);
    font-size: 1.3rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
    line-height: 1;
  }
  .weight-btn:active {
    background: var(--gold);
    color: var(--black);
    transform: scale(0.92);
  }
  .weight-display {
    font-family: 'Oswald', sans-serif;
    font-size: 1.6rem;
    font-weight: 700;
    color: var(--gold);
    min-width: 80px;
    text-align: center;
  }
  .weight-unit {
    font-size: 0.85rem;
    font-weight: 400;
    color: var(--text-dim);
    margin-left: 2px;
  }

  /* Set buttons */
  .sets-row {
    display: flex;
    gap: 8px;
    justify-content: center;
  }
  .set-btn {
    width: 52px;
    height: 52px;
    border-radius: 10px;
    border: 1px solid var(--card-border);
    background: var(--near-black);
    color: var(--text-dim);
    font-family: 'Oswald', sans-serif;
    font-size: 0.85rem;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.15s;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2px;
  }
  .set-btn .set-num { font-size: 0.65rem; opacity: 0.6; }
  .set-btn .set-reps { font-size: 1rem; font-weight: 600; }
  .set-btn.done {
    background: var(--orange);
    border-color: var(--orange);
    color: var(--black);
    box-shadow: 0 0 12px rgba(241, 115, 0, 0.25);
  }
  .set-btn.done.partial {
    background: rgba(241, 115, 0, 0.6);
    border-color: rgba(241, 115, 0, 0.6);
    box-shadow: 0 0 8px rgba(241, 115, 0, 0.15);
  }
  .set-btn:active { transform: scale(0.9); }

  /* Complete button */
  .complete-btn {
    width: 100%;
    padding: 16px;
    border: none;
    border-radius: 12px;
    font-family: 'Oswald', sans-serif;
    font-size: 1.1rem;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    margin-top: 8px;
    transition: all 0.2s;
    background: var(--card-border);
    color: var(--text-dim);
  }
  .complete-btn.ready {
    background: var(--orange);
    color: var(--black);
    box-shadow: 0 4px 20px rgba(241, 115, 0, 0.3);
  }
  .complete-btn.ready:active {
    transform: scale(0.97);
    box-shadow: 0 2px 10px rgba(241, 115, 0, 0.4);
  }

  /* ‚îÄ‚îÄ Stats View ‚îÄ‚îÄ */
  .stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 24px;
  }
  .stat-card {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 18px;
    text-align: center;
  }
  .stat-value {
    font-family: 'Oswald', sans-serif;
    font-size: 2rem;
    font-weight: 700;
    color: var(--gold);
  }
  .stat-label {
    font-size: 0.7rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-top: 4px;
  }

  /* ‚îÄ‚îÄ History View ‚îÄ‚îÄ */
  .history-item {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 10px;
    padding: 14px 16px;
    margin-bottom: 10px;
  }
  .history-date {
    font-family: 'Oswald', sans-serif;
    font-size: 0.85rem;
    color: var(--gold);
    letter-spacing: 1px;
    margin-bottom: 6px;
  }
  .history-type {
    font-family: 'Oswald', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--orange);
    margin-bottom: 8px;
  }
  .history-exercise {
    font-size: 0.82rem;
    color: var(--text-dim);
    line-height: 1.6;
  }
  .history-exercise span { color: var(--gold); font-weight: 500; }

  .empty-state {
    text-align: center;
    color: var(--text-dim);
    padding: 40px 20px;
    font-size: 0.9rem;
  }
  .empty-state .icon { font-size: 2.5rem; margin-bottom: 12px; }

  /* ‚îÄ‚îÄ Info / Program Section ‚îÄ‚îÄ */
  .info-card {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 18px;
    margin-bottom: 14px;
  }
  .info-card h3 {
    font-family: 'Oswald', sans-serif;
    font-size: 0.9rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 10px;
  }
  .info-card p, .info-card li {
    font-size: 0.82rem;
    color: var(--text-dim);
    line-height: 1.7;
  }
  .info-card ul { padding-left: 18px; }
  .info-card li { margin-bottom: 4px; }

  /* ‚îÄ‚îÄ Progress Charts ‚îÄ‚îÄ */
  .progress-chart {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 18px;
    margin-bottom: 14px;
  }
  .progress-chart h3 {
    font-family: 'Oswald', sans-serif;
    font-size: 0.9rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 14px;
  }
  .progress-chart svg {
    width: 100%;
    height: auto;
    display: block;
  }
  .chart-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: 12px;
  }
  .chart-legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.72rem;
    color: var(--text-dim);
    letter-spacing: 0.5px;
  }
  .chart-legend-swatch {
    width: 12px;
    height: 3px;
    border-radius: 2px;
    flex-shrink: 0;
  }

  /* ‚îÄ‚îÄ Hidden sections ‚îÄ‚îÄ */
  .section { display: none; }
  .section.active { display: block; }

  /* ‚îÄ‚îÄ Reset confirmation ‚îÄ‚îÄ */
  .reset-btn {
    display: block;
    margin: 30px auto 0;
    padding: 10px 24px;
    background: none;
    border: 1px solid #331111;
    border-radius: 8px;
    color: #664444;
    font-family: 'Oswald', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
  }
  .reset-btn:hover { border-color: #663333; color: #aa5555; }

  /* toast */
  .toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--gold);
    color: var(--black);
    font-family: 'Oswald', sans-serif;
    font-size: 0.9rem;
    letter-spacing: 1px;
    padding: 12px 28px;
    border-radius: 30px;
    opacity: 0;
    transition: all 0.3s ease;
    pointer-events: none;
    z-index: 100;
  }
  .toast.show {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
  }

  /* ‚îÄ‚îÄ Rest Timer ‚îÄ‚îÄ */
  .rest-timer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--card-bg);
    border-top: 1px solid var(--card-border);
    z-index: 90;
    transform: translateY(100%);
    opacity: 0;
    transition: all 0.3s ease;
    cursor: pointer;
  }
  .rest-timer.active {
    transform: translateY(0);
    opacity: 1;
  }
  .rest-timer-bar {
    position: absolute;
    top: 0;
    left: 0;
    height: 3px;
    background: var(--orange);
    transition: width 1s linear;
  }
  .rest-timer-text {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 14px 20px;
  }
  .rest-timer-time {
    font-family: 'Oswald', sans-serif;
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--gold);
    letter-spacing: 2px;
  }
  .rest-timer-hint {
    font-size: 0.7rem;
    color: var(--text-dim);
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  /* ‚îÄ‚îÄ Program Tab ‚îÄ‚îÄ */
  .program-card {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 18px;
    margin-bottom: 14px;
  }
  .program-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    font-family: 'Oswald', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gold);
  }
  .program-action-btn {
    background: var(--gold-dim);
    border: 1px solid var(--gold-mid);
    color: var(--gold);
    font-family: 'Oswald', sans-serif;
    font-size: 0.7rem;
    letter-spacing: 1px;
    text-transform: uppercase;
    padding: 5px 12px;
    border-radius: 6px;
    cursor: pointer;
    margin-left: 6px;
    transition: all 0.15s;
  }
  .program-action-btn:active {
    background: var(--gold);
    color: var(--black);
  }
  .program-action-btn.remove {
    border-color: #331111;
    color: #664444;
    background: none;
  }
  .program-action-btn.remove:active {
    background: #664444;
    color: var(--black);
  }
  .program-card-exercise {
    font-size: 0.85rem;
    color: var(--text-dim);
    padding: 4px 0;
    display: flex;
    justify-content: space-between;
  }
  .program-card-exercise span {
    color: var(--gold);
    font-weight: 500;
  }
  .balance-check .balance-badges {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }
  .balance-ok {
    color: #5a9a5a;
    font-family: 'Oswald', sans-serif;
    font-size: 0.85rem;
    letter-spacing: 1px;
  }
  .balance-warn {
    color: var(--orange);
    font-family: 'Oswald', sans-serif;
    font-size: 0.85rem;
    letter-spacing: 1px;
  }
  .balance-warning-text {
    margin-top: 8px;
    color: var(--orange) !important;
    font-size: 0.78rem !important;
  }
  .add-workout-btn {
    width: 100%;
    padding: 14px;
    border: 1px dashed var(--card-border);
    border-radius: 12px;
    background: none;
    color: var(--text-dim);
    font-family: 'Oswald', sans-serif;
    font-size: 0.9rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    margin-bottom: 14px;
    transition: all 0.2s;
  }
  .add-workout-btn:hover {
    border-color: var(--gold-mid);
    color: var(--gold);
  }
  .cancel-btn {
    border-style: solid;
    border-color: #331111;
    color: #664444;
  }
  .reference-divider {
    text-align: center;
    font-family: 'Oswald', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--text-dim);
    margin: 24px 0 16px;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .reference-divider::before, .reference-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--card-border);
  }

  /* ‚îÄ‚îÄ Edit Workout Sub-View ‚îÄ‚îÄ */
  .edit-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
    font-family: 'Oswald', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gold);
  }
  .edit-back-btn {
    background: none;
    border: none;
    color: var(--gold);
    font-family: 'Oswald', sans-serif;
    font-size: 0.85rem;
    letter-spacing: 1px;
    cursor: pointer;
    padding: 4px 0;
  }
  .edit-section-label {
    font-family: 'Oswald', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-bottom: 8px;
  }
  .edit-selected {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 8px;
    margin-bottom: 20px;
  }
  .edit-selected-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    font-size: 0.85rem;
    color: var(--text);
  }
  .edit-remove-btn {
    background: none;
    border: none;
    color: #664444;
    font-size: 1.1rem;
    cursor: pointer;
    padding: 2px 6px;
  }
  .exercise-group-header {
    font-family: 'Oswald', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-dim);
    margin: 16px 0 8px;
  }
  .exercise-option {
    display: block;
    width: 100%;
    text-align: left;
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 8px;
    padding: 12px 14px;
    margin-bottom: 6px;
    color: var(--text);
    font-size: 0.85rem;
    font-family: 'Source Sans 3', sans-serif;
    cursor: pointer;
    transition: all 0.15s;
  }
  .exercise-option:active {
    transform: scale(0.98);
  }
  .exercise-option.selected {
    border-color: var(--orange);
    color: var(--orange);
    background: var(--orange-dim);
  }
  .exercise-option.disabled {
    opacity: 0.3;
    cursor: default;
  }
  .exercise-option.disabled:active {
    transform: none;
  }
  .edit-hint {
    font-size: 0.75rem;
    color: var(--orange);
    text-align: center;
    margin-bottom: 12px;
    letter-spacing: 0.5px;
  }

  /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
  .footer {
    text-align: center;
    padding: 32px 20px 24px;
    border-top: 1px solid var(--card-border);
    max-width: 500px;
    margin: 0 auto;
  }
  .footer-socials {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 12px;
  }
  .footer-socials a {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 1px solid var(--card-border);
    color: var(--text-dim);
    transition: all 0.2s;
    text-decoration: none;
  }
  .footer-socials a:hover {
    border-color: var(--gold-mid);
    color: var(--gold);
  }
  .footer-socials a svg {
    width: 16px;
    height: 16px;
    fill: currentColor;
  }
  .footer-email {
    font-size: 0.72rem;
    color: var(--text-dim);
    letter-spacing: 1px;
  }
  .footer-email a {
    color: var(--text-dim);
    text-decoration: none;
    transition: color 0.2s;
  }
  .footer-email a:hover {
    color: var(--gold);
  }

  /* ‚îÄ‚îÄ Auth Bar ‚îÄ‚îÄ */
  #auth-bar {
    margin-top: 10px;
  }
  .auth-signin-btn {
    background: none;
    border: 1px solid var(--gold-mid);
    color: var(--gold);
    font-family: 'Oswald', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    padding: 8px 20px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .auth-signin-btn:hover {
    border-color: var(--gold);
    color: var(--text);
  }
  .auth-signin-btn:active {
    background: var(--gold);
    color: var(--black);
    transform: scale(0.96);
  }
  .auth-user-info {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }
  .auth-user-photo {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: 1px solid var(--card-border);
  }
  .auth-user-name {
    font-family: 'Oswald', sans-serif;
    font-size: 0.8rem;
    letter-spacing: 1px;
    color: var(--text-dim);
  }
  .auth-signout-btn {
    background: none;
    border: none;
    color: var(--text-dim);
    font-family: 'Oswald', sans-serif;
    font-size: 0.7rem;
    letter-spacing: 1px;
    text-transform: uppercase;
    cursor: pointer;
    padding: 2px 0;
    transition: color 0.2s;
  }
  .auth-signout-btn:hover {
    color: var(--gold);
  }

  /* ‚îÄ‚îÄ Welcome Overlay ‚îÄ‚îÄ */
  .welcome-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.92);
    z-index: 200;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  .welcome-card {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 16px;
    padding: 32px 24px;
    max-width: 380px;
    width: 100%;
    text-align: center;
  }
  .welcome-card h2 {
    font-family: 'Oswald', sans-serif;
    font-size: 1.4rem;
    font-weight: 700;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--orange);
    margin-bottom: 16px;
  }
  .welcome-card p {
    font-size: 0.88rem;
    color: var(--text-dim);
    line-height: 1.7;
    margin-bottom: 12px;
  }
  .welcome-card ul {
    text-align: left;
    list-style: none;
    padding: 0;
    margin: 16px 0;
  }
  .welcome-card li {
    font-size: 0.82rem;
    color: var(--text-dim);
    line-height: 1.8;
    padding-left: 20px;
    position: relative;
  }
  .welcome-card li::before {
    content: '';
    position: absolute;
    left: 0;
    top: 10px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--orange);
  }
  .welcome-start-btn {
    width: 100%;
    padding: 14px;
    border: none;
    border-radius: 12px;
    background: var(--orange);
    color: var(--black);
    font-family: 'Oswald', sans-serif;
    font-size: 1.05rem;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    margin-top: 8px;
    transition: all 0.2s;
  }
  .welcome-start-btn:active {
    transform: scale(0.97);
  }

  /* ‚îÄ‚îÄ Gear Section ‚îÄ‚îÄ */
  .gear-item {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 12px 0;
    border-bottom: 1px solid var(--card-border);
  }
  .gear-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
  }
  .gear-item:first-of-type {
    padding-top: 0;
  }
  .gear-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
    width: 36px;
    text-align: center;
  }
  .gear-info {
    flex: 1;
    min-width: 0;
  }
  .gear-name {
    font-family: 'Oswald', sans-serif;
    font-size: 0.85rem;
    font-weight: 600;
    letter-spacing: 0.5px;
    color: var(--text);
    margin-bottom: 2px;
  }
  .gear-desc {
    font-size: 0.75rem;
    color: var(--text-dim);
    line-height: 1.4;
  }
  .gear-link {
    flex-shrink: 0;
    font-family: 'Oswald', sans-serif;
    font-size: 0.7rem;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--orange);
    text-decoration: none;
    padding: 6px 12px;
    border: 1px solid var(--orange-dim);
    border-radius: 6px;
    transition: all 0.15s;
  }
  .gear-link:active {
    background: var(--orange);
    color: var(--black);
  }
</style>
</head>
<body>

<div class="welcome-overlay" id="welcomeOverlay" style="display:none;">
  <div class="welcome-card">
    <h2>Welcome to DumbLifts</h2>
    <p>A simple 5√ó5 strength program built for dumbbells. Three exercises, five sets of five, three days a week.</p>
    <ul>
      <li>Tap sets to mark them complete</li>
      <li>Adjust weight in 5 lb jumps</li>
      <li>Customize your program under the Program tab</li>
      <li>Sign in with Google to sync across devices</li>
    </ul>
    <button class="welcome-start-btn" onclick="dismissWelcome()">Let's Go</button>
  </div>
</div>

<div class="header">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 730 160">
    <rect x="62" y="68" width="70" height="14" rx="7" fill="#F17300"/>
    <rect x="34" y="42" width="36" height="66" rx="7" fill="#F17300"/>
    <rect x="14" y="50" width="28" height="50" rx="5" fill="#F17300"/>
    <rect x="124" y="42" width="36" height="66" rx="7" fill="#F17300"/>
    <rect x="152" y="50" width="28" height="50" rx="5" fill="#F17300"/>
    <rect x="208" y="36" width="4" height="78" rx="2" fill="#F17300" opacity="0.4"/>
    <text x="240" y="110" font-family="Oswald, sans-serif" font-weight="700" font-size="78" fill="#F17300" letter-spacing="8">DUMBLIFTS</text>
  </svg>
  <div class="subtitle">Lift Stupid Heavy</div>
  <div id="auth-bar"></div>
</div>

<div class="nav">
  <button class="active" onclick="showSection('workout')">Workout</button>
  <button onclick="showSection('history')">History</button>
  <button onclick="showSection('stats')">Stats</button>
  <button onclick="showSection('program')">Program</button>
</div>

<div class="content">
  <!-- WORKOUT -->
  <div id="sec-workout" class="section active"></div>

  <!-- HISTORY -->
  <div id="sec-history" class="section"></div>

  <!-- STATS -->
  <div id="sec-stats" class="section"></div>

  <!-- PROGRAM -->
  <div id="sec-program" class="section"></div>
</div>

<footer class="footer">
  <div class="footer-socials">
    <a href="mailto:jason@dumblifts.com" aria-label="Email">
      <svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
    </a>
    <a href="https://instagram.com/dumbliftsdotcom" target="_blank" rel="noopener" aria-label="Instagram">
      <svg viewBox="0 0 24 24"><path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 01-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 017.8 2zm-.2 2A3.6 3.6 0 004 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8a3.6 3.6 0 003.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6zm9.65 1.5a1.25 1.25 0 110 2.5 1.25 1.25 0 010-2.5zM12 7a5 5 0 110 10 5 5 0 010-10zm0 2a3 3 0 100 6 3 3 0 000-6z"/></svg>
    </a>
    <a href="https://x.com/dumbliftsdotcom" target="_blank" rel="noopener" aria-label="X">
      <svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
    </a>
    <a href="https://ko-fi.com/dumblifts" target="_blank" rel="noopener" aria-label="Ko-fi">
      <svg viewBox="0 0 24 24"><path d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604 0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734 4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09-.443-.441-3.368-3.049-4.034-3.954-.709-.965-1.041-2.7-.091-3.71.951-1.01 3.005-1.086 4.363.407 0 0 1.565-1.782 3.468-.963 1.904.82 1.832 3.011.723 4.311zm6.173.478c-.928.116-1.682.028-1.682.028V7.284h1.77s1.971.551 1.971 2.638c0 1.913-.985 2.667-2.059 3.015z"/></svg>
    </a>
    <a href="https://cash.app/$dumblifts" target="_blank" rel="noopener" aria-label="Cash App">
      <svg viewBox="0 0 24 24"><path d="M13.153 4.21l.594-2.244a.754.754 0 01.924-.53l1.378.364a.754.754 0 01.53.924l-.594 2.244c1.419.538 2.678 1.353 3.237 1.857a.754.754 0 01.066 1.063l-.964 1.132a.754.754 0 01-1.063.066c-.721-.614-2.002-1.4-3.51-1.799l-.737 2.784c3.037 1.063 5.17 2.27 4.487 4.852-.544 2.058-2.592 3.174-5.107 3.283l-.594 2.244a.754.754 0 01-.924.53l-1.378-.364a.754.754 0 01-.53-.924l.594-2.244c-1.782-.454-3.22-1.344-3.95-2.032a.754.754 0 01-.032-1.066l1.024-1.073a.754.754 0 011.066-.032c.86.82 2.272 1.62 4.018 2.064l.752-2.842c-2.858-1.005-5.127-2.208-4.394-4.981.544-2.058 2.68-3.108 5.087-3.196zm-1.818 6.12l-.7 2.643c1.327.467 2.04.636 2.742.43.765-.225 1.118-.768 1.254-1.282.32-1.211-.587-1.59-3.296-1.791zm2.463-5.313c-.764.225-1.085.736-1.22 1.25-.265 1.001.19 1.462 2.782 1.733l.651-2.46c-1.11-.403-1.695-.55-2.213-.523z"/></svg>
    </a>
  </div>
  <div class="footer-email"><a href="mailto:jason@dumblifts.com">jason@dumblifts.com</a></div>
  <div class="footer-email" style="margin-top:8px;"><a href="/blog/dumbbell-5x5-program.html">Blog</a></div>
</footer>

<div class="rest-timer" id="restTimer" onclick="clearRestTimer()"></div>
<div class="toast" id="toast"></div>

<script src="https://www.gstatic.com/firebasejs/11.3.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.3.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.3.0/firebase-firestore-compat.js"></script>

<script>
// ‚îÄ‚îÄ Firebase Init ‚îÄ‚îÄ
firebase.initializeApp({
  apiKey: "AIzaSyBvYFI-FrC-_-egPi1giGqjUij95Y1Pp0Q",
  authDomain: "dumblifts-a9751.firebaseapp.com",
  projectId: "dumblifts-a9751",
  storageBucket: "dumblifts-a9751.firebasestorage.app",
  messagingSenderId: "445499232452",
  appId: "1:445499232452:web:432c8f757f32540aff3991",
  measurementId: "G-1MD27ZZEC5"
});
const db = firebase.firestore();
const auth = firebase.auth();

// Offline persistence for Firestore (PWA support)
db.enablePersistence({ synchronizeTabs: true }).catch(() => {});

// ‚îÄ‚îÄ Exercise Library ‚îÄ‚îÄ
const EXERCISE_LIBRARY = [
  // Legs
  { id: 'goblet_squat', name: 'Goblet Squat', note: 'One dumbbell at chest, squat deep', group: 'legs', defaultWeight: 30, unit: 'lb' },
  { id: 'db_rdl', name: 'Romanian Deadlift', note: 'Hinge at hips, slight knee bend', group: 'legs', defaultWeight: 30, unit: 'lb ea.' },
  { id: 'db_lunge', name: 'Lunge', note: 'Step forward, lower back knee', group: 'legs', defaultWeight: 20, unit: 'lb ea.' },
  { id: 'db_bulgarian', name: 'Bulgarian Split Squat', note: 'Rear foot elevated, squat down', group: 'legs', defaultWeight: 20, unit: 'lb ea.' },
  { id: 'db_stepup', name: 'Step-Up', note: 'Step onto bench, drive up', group: 'legs', defaultWeight: 20, unit: 'lb ea.' },
  { id: 'db_sumo', name: 'Sumo Squat', note: 'Wide stance, dumbbell hangs between legs', group: 'legs', defaultWeight: 30, unit: 'lb' },
  { id: 'db_thruster', name: 'Thruster', note: 'Squat into overhead press, full body', group: 'legs', defaultWeight: 20, unit: 'lb ea.' },
  { id: 'db_clean_press', name: 'Clean & Press', note: 'Deadlift pull into overhead press', group: 'legs', defaultWeight: 20, unit: 'lb ea.' },
  // Push
  { id: 'db_bench', name: 'Bench Press', note: 'Flat bench, press up', group: 'push', defaultWeight: 20, unit: 'lb ea.' },
  { id: 'db_floor', name: 'Floor Press', note: 'Lie on floor, press up', group: 'push', defaultWeight: 20, unit: 'lb ea.' },
  { id: 'db_ohp', name: 'Overhead Press', note: 'Standing, press straight up', group: 'push', defaultWeight: 15, unit: 'lb ea.' },
  { id: 'db_incline', name: 'Incline Press', note: 'Incline bench, press up at angle', group: 'push', defaultWeight: 20, unit: 'lb ea.' },
  { id: 'db_arnold', name: 'Arnold Press', note: 'Rotate palms as you press up', group: 'push', defaultWeight: 15, unit: 'lb ea.' },
  { id: 'db_lateral', name: 'Lateral Raise', note: 'Raise out to sides, slight bend', group: 'push', defaultWeight: 10, unit: 'lb ea.' },
  // Pull
  { id: 'db_row', name: 'Row', note: 'Bent-over, pull to hip', group: 'pull', defaultWeight: 20, unit: 'lb ea.' },
  { id: 'db_reverse_fly', name: 'Reverse Fly', note: 'Bent-over, fly out to sides', group: 'pull', defaultWeight: 10, unit: 'lb ea.' },
  { id: 'db_shrug', name: 'Shrug', note: 'Shrug shoulders up, hold at top', group: 'pull', defaultWeight: 25, unit: 'lb ea.' },
  { id: 'db_pullover', name: 'Pullover', note: 'Lie on bench, arc dumbbell over head', group: 'pull', defaultWeight: 20, unit: 'lb' },
  { id: 'db_curl', name: 'Curl', note: 'Curl up, squeeze at top', group: 'pull', defaultWeight: 15, unit: 'lb ea.' },
  { id: 'db_hammer', name: 'Hammer Curl', note: 'Neutral grip, curl up', group: 'pull', defaultWeight: 15, unit: 'lb ea.' }
];

const DEFAULT_PROGRAM = [
  { id: 'A', label: 'Workout A', exerciseIds: ['goblet_squat', 'db_bench', 'db_row'] },
  { id: 'B', label: 'Workout B', exerciseIds: ['db_rdl', 'db_ohp', 'db_floor'] }
];

// ‚îÄ‚îÄ Derived WORKOUTS (rebuilt from state.program + library) ‚îÄ‚îÄ
let WORKOUTS = {};

function buildWorkouts() {
  WORKOUTS = {};
  state.program.forEach(pw => {
    WORKOUTS[pw.id] = {
      label: pw.label,
      exercises: pw.exerciseIds.map(eid => {
        const lib = EXERCISE_LIBRARY.find(e => e.id === eid);
        return lib ? { id: lib.id, name: lib.name, note: lib.note, defaultWeight: lib.defaultWeight, unit: lib.unit } : null;
      }).filter(Boolean)
    };
  });
}

// ‚îÄ‚îÄ State ‚îÄ‚îÄ
function defaultState() {
  const program = JSON.parse(JSON.stringify(DEFAULT_PROGRAM));
  const weights = {};
  program.forEach(pw => {
    pw.exerciseIds.forEach(eid => {
      const lib = EXERCISE_LIBRARY.find(e => e.id === eid);
      if (lib) weights[eid] = lib.defaultWeight;
    });
  });
  return {
    nextWorkout: 'A',
    weights,
    currentSets: {},
    history: [],
    totalWorkouts: 0,
    program
  };
}

function migrateCurrentSets(data) {
  if (!data.currentSets) return;
  Object.keys(data.currentSets).forEach(exId => {
    data.currentSets[exId] = data.currentSets[exId].map(v =>
      v === true ? 5 : v === false ? 0 : v
    );
  });
}

function loadState() {
  try {
    const s = localStorage.getItem('dumblifts');
    if (s) {
      const parsed = JSON.parse(s);
      // Migration: add program if missing (existing users)
      if (!parsed.program) {
        parsed.program = JSON.parse(JSON.stringify(DEFAULT_PROGRAM));
      }
      migrateCurrentSets(parsed);
      return parsed;
    }
  } catch(e) {}
  return defaultState();
}

let state = loadState();
buildWorkouts();

function saveState() {
  localStorage.setItem('dumblifts', JSON.stringify(state));
  syncToFirestore();
}

// ‚îÄ‚îÄ Rest Timer State ‚îÄ‚îÄ
let restTimer = null;
let restTimeLeft = 0;

// ‚îÄ‚îÄ Edit Workout State ‚îÄ‚îÄ
let editingWorkoutIdx = null;
let editNewWorkoutId = null;
let editSelectedIds = [];

// ‚îÄ‚îÄ Render ‚îÄ‚îÄ
function renderWorkout() {
  const sec = document.getElementById('sec-workout');
  const wo = WORKOUTS[state.nextWorkout];

  if (!wo) {
    sec.innerHTML = '<div class="empty-state">No workout found. Check your program settings.</div>';
    return;
  }

  // Init current sets if needed
  wo.exercises.forEach(ex => {
    if (!state.currentSets[ex.id] || state.currentSets[ex.id].length !== 5) {
      state.currentSets[ex.id] = [0, 0, 0, 0, 0];
    }
  });

  let html = `<div class="workout-label">${wo.label}</div>`;

  wo.exercises.forEach(ex => {
    const sets = state.currentSets[ex.id];
    const allDone = sets.every(v => v > 0);
    html += `
      <div class="exercise-card ${allDone ? 'all-done' : ''}">
        <div class="exercise-name">${ex.name}</div>
        <div class="exercise-note">${ex.note}</div>
        <div class="weight-row">
          <button class="weight-btn" onclick="changeWeight('${ex.id}', -5)">‚àí</button>
          <div class="weight-display">${state.weights[ex.id]}<span class="weight-unit">${ex.unit}</span></div>
          <button class="weight-btn" onclick="changeWeight('${ex.id}', 5)">+</button>
        </div>
        <div class="sets-row">
          ${sets.map((reps, i) => `
            <button class="set-btn ${reps > 0 ? (reps === 5 ? 'done' : 'done partial') : ''}" onclick="toggleSet('${ex.id}', ${i})">
              <span class="set-num">S${i+1}</span>
              <span class="set-reps">√ó${reps > 0 ? reps : 5}</span>
            </button>
          `).join('')}
        </div>
      </div>`;
  });

  const allComplete = wo.exercises.every(ex => state.currentSets[ex.id].every(v => v > 0));
  html += `<button class="complete-btn ${allComplete ? 'ready' : ''}"
    onclick="${allComplete ? 'completeWorkout()' : ''}"
    ${allComplete ? '' : 'disabled'}>
    ${allComplete ? 'Complete Workout ‚úì' : 'Finish All Sets'}
  </button>`;

  sec.innerHTML = html;
}

function renderHistory() {
  const sec = document.getElementById('sec-history');
  if (!state.history.length) {
    sec.innerHTML = `<div class="empty-state"><div class="icon">üèãÔ∏è</div>No workouts yet. Go lift something.</div>`;
    return;
  }
  let html = '';
  state.history.slice().reverse().slice(0, 20).forEach(entry => {
    html += `<div class="history-item">
      <div class="history-date">${entry.date}</div>
      <div class="history-type">${entry.type}</div>
      <div class="history-exercise">
        ${entry.exercises.map(e => {
          const repsStr = e.sets ? ` <span style="color:${e.sets.every(s => s === 5) ? 'var(--gold)' : 'var(--text-dim)'}">(${e.sets.join('/')})</span>` : '';
          return `${e.name}: <span>${e.weight} ${e.unit}</span>${repsStr}`;
        }).join('<br>')}
      </div>
    </div>`;
  });
  sec.innerHTML = html;
}

function renderProgressChart(workoutLabel, exercises, colors, history) {
  const entries = history.filter(h => h.type === workoutLabel);
  if (entries.length < 2) return '';

  const pad = { top: 16, right: 16, bottom: 28, left: 38 };
  const W = 400, H = 180;
  const plotW = W - pad.left - pad.right;
  const plotH = H - pad.top - pad.bottom;

  // Build per-exercise data series: [{name, color, points: [{x, y}]}]
  const series = exercises.map((ex, i) => {
    const points = entries.map((entry, idx) => {
      const found = entry.exercises.find(e => e.name === ex.name);
      return { x: idx, y: found ? found.weight : null };
    }).filter(p => p.y !== null);
    return { name: ex.name, color: colors[i], points };
  });

  // Compute Y range across all series
  let allY = [];
  series.forEach(s => s.points.forEach(p => allY.push(p.y)));
  if (!allY.length) return '';
  let minY = Math.min(...allY);
  let maxY = Math.max(...allY);
  if (minY === maxY) { minY -= 5; maxY += 5; }
  const yPad = (maxY - minY) * 0.15;
  minY = Math.floor((minY - yPad) / 5) * 5;
  maxY = Math.ceil((maxY + yPad) / 5) * 5;
  if (minY < 0) minY = 0;

  const n = entries.length;
  const scaleX = (idx) => pad.left + (n === 1 ? plotW / 2 : (idx / (n - 1)) * plotW);
  const scaleY = (val) => pad.top + plotH - ((val - minY) / (maxY - minY)) * plotH;

  // Grid lines (horizontal)
  const gridSteps = 4;
  let gridSvg = '';
  for (let i = 0; i <= gridSteps; i++) {
    const val = minY + (maxY - minY) * (i / gridSteps);
    const y = scaleY(val);
    gridSvg += `<line x1="${pad.left}" y1="${y}" x2="${W - pad.right}" y2="${y}" stroke="#1a1a1a" stroke-width="1"/>`;
    gridSvg += `<text x="${pad.left - 6}" y="${y + 3.5}" text-anchor="end" fill="#8a8478" font-size="10" font-family="Oswald, sans-serif">${Math.round(val)}</text>`;
  }

  // X axis labels (dates)
  let xLabelSvg = '';
  const labelIndices = new Set([0, n - 1]);
  if (n > 4) labelIndices.add(Math.floor(n / 2));
  if (n > 8) { labelIndices.add(Math.floor(n / 4)); labelIndices.add(Math.floor(3 * n / 4)); }
  labelIndices.forEach(idx => {
    const x = scaleX(idx);
    const raw = entries[idx].date;
    const parts = raw.split(', ');
    const short = parts.length >= 2 ? parts[1].replace(/,.*/, '') : raw;
    xLabelSvg += `<text x="${x}" y="${H - 4}" text-anchor="middle" fill="#8a8478" font-size="9" font-family="Oswald, sans-serif">${short}</text>`;
  });

  // Lines + dots
  let linesSvg = '';
  series.forEach(s => {
    if (s.points.length < 2) return;
    const polyPoints = s.points.map(p => `${scaleX(p.x).toFixed(1)},${scaleY(p.y).toFixed(1)}`).join(' ');
    linesSvg += `<polyline points="${polyPoints}" fill="none" stroke="${s.color}" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>`;
    s.points.forEach(p => {
      linesSvg += `<circle cx="${scaleX(p.x).toFixed(1)}" cy="${scaleY(p.y).toFixed(1)}" r="3" fill="${s.color}"/>`;
    });
  });

  // Legend
  const legendHtml = series.map(s =>
    `<div class="chart-legend-item"><span class="chart-legend-swatch" style="background:${s.color}"></span>${s.name}</div>`
  ).join('');

  return `
    <div class="progress-chart">
      <h3>${workoutLabel} Progress</h3>
      <svg viewBox="0 0 ${W} ${H}" preserveAspectRatio="xMidYMid meet">
        ${gridSvg}
        ${xLabelSvg}
        ${linesSvg}
      </svg>
      <div class="chart-legend">${legendHtml}</div>
    </div>`;
}

function renderStats() {
  const sec = document.getElementById('sec-stats');
  const weekNum = Math.floor(state.totalWorkouts / 3) + 1;

  // Dynamic workout counts
  let countHtml = '';
  state.program.forEach(pw => {
    const count = state.history.filter(h => h.type === pw.label).length;
    countHtml += `<div class="stat-card">
      <div class="stat-value">${count}</div>
      <div class="stat-label">${pw.label}</div>
    </div>`;
  });

  // Current weights
  let maxHtml = '';
  Object.values(WORKOUTS).forEach(w => {
    w.exercises.forEach(ex => {
      maxHtml += `<div class="history-exercise" style="padding:4px 0;">${ex.name}: <span style="color:var(--gold);font-weight:600;">${state.weights[ex.id]} ${ex.unit}</span></div>`;
    });
  });

  // Progress charts ‚Äî warm tones for even index, cool for odd
  const colorSets = [
    ['#F17300', '#E8943A', '#D4A55A'],
    ['#7A8B8B', '#5E9BA8', '#8BAAB5'],
    ['#F17300', '#E8943A', '#D4A55A'],
    ['#7A8B8B', '#5E9BA8', '#8BAAB5']
  ];
  let chartsHtml = '';
  state.program.forEach((pw, idx) => {
    const wo = WORKOUTS[pw.id];
    if (wo) {
      chartsHtml += renderProgressChart(pw.label, wo.exercises, colorSets[idx % colorSets.length], state.history);
    }
  });

  sec.innerHTML = `
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value">${state.totalWorkouts}</div>
        <div class="stat-label">Total Workouts</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">${weekNum}</div>
        <div class="stat-label">Current Week</div>
      </div>
      ${countHtml}
    </div>
    <div class="info-card">
      <h3>Current Weights</h3>
      ${maxHtml}
    </div>
    ${chartsHtml}`;
}

// ‚îÄ‚îÄ Program Tab ‚îÄ‚îÄ
function renderProgram() {
  const sec = document.getElementById('sec-program');

  let html = '<div class="workout-label">Your Program</div>';

  // Workout cards
  state.program.forEach((pw, idx) => {
    const wo = WORKOUTS[pw.id];
    html += `<div class="program-card">
      <div class="program-card-header">
        <span>${pw.label}</span>
        <div>
          <button class="program-action-btn" onclick="editWorkout(${idx})">Edit</button>
          ${state.program.length > 2 ? `<button class="program-action-btn remove" onclick="removeWorkout(${idx})">√ó</button>` : ''}
        </div>
      </div>`;
    if (wo) {
      wo.exercises.forEach(ex => {
        html += `<div class="program-card-exercise"><span style="color:var(--text-dim);font-weight:400;">${ex.name}</span> <span>${state.weights[ex.id]} ${ex.unit}</span></div>`;
      });
    }
    html += '</div>';
  });

  // Add workout button
  if (state.program.length < 4) {
    html += `<button class="add-workout-btn" onclick="addWorkout()">+ Add Workout</button>`;
  }

  // Balance check
  const allExerciseIds = new Set();
  state.program.forEach(pw => pw.exerciseIds.forEach(id => allExerciseIds.add(id)));
  const groups = new Set();
  allExerciseIds.forEach(id => {
    const lib = EXERCISE_LIBRARY.find(e => e.id === id);
    if (lib) groups.add(lib.group);
  });
  const hasLegs = groups.has('legs');
  const hasPush = groups.has('push');
  const hasPull = groups.has('pull');

  html += `<div class="info-card balance-check">
    <h3>Balance Check</h3>
    <div class="balance-badges">
      <span class="${hasPush ? 'balance-ok' : 'balance-warn'}">${hasPush ? '‚úì' : '‚úó'} Push</span>
      <span class="${hasPull ? 'balance-ok' : 'balance-warn'}">${hasPull ? '‚úì' : '‚úó'} Pull</span>
      <span class="${hasLegs ? 'balance-ok' : 'balance-warn'}">${hasLegs ? '‚úì' : '‚úó'} Legs</span>
    </div>
    ${(!hasLegs || !hasPush || !hasPull) ? '<p class="balance-warning-text">Your program is missing muscle groups. Consider adding exercises for balanced development.</p>' : ''}
  </div>`;

  // Presets
  html += `<div class="info-card">
    <h3>Presets</h3>
    <button class="add-workout-btn" onclick="restoreDefault()" style="margin-top:0;">Restore Default</button>
  </div>`;

  // Data export/import
  html += `<div class="info-card">
    <h3>Your Data</h3>
    <button class="add-workout-btn" onclick="exportData()" style="margin-top:0;">Export Backup</button>
    <button class="add-workout-btn" onclick="importData()">Import Backup</button>
  </div>`;

  // Reference divider
  html += '<div class="reference-divider">Reference</div>';

  // Gear recommendations
  html += `<div class="info-card">
    <h3>Budget Gear</h3>
    <div class="gear-item">
      <span class="gear-icon">üèãÔ∏è</span>
      <div class="gear-info">
        <div class="gear-name">Adjustable Dumbbell Set</div>
        <div class="gear-desc">All the weight you need to start. Great for home gyms.</div>
      </div>
      <a class="gear-link" href="https://www.amazon.com/s?k=adjustable+dumbbell+set&tag=dumblifts-20" target="_blank" rel="noopener">Shop</a>
    </div>
    <div class="gear-item">
      <span class="gear-icon">ü™ë</span>
      <div class="gear-info">
        <div class="gear-name">Flat / Incline Bench</div>
        <div class="gear-desc">Fold-up style works fine. Opens up bench and incline press.</div>
      </div>
      <a class="gear-link" href="https://www.amazon.com/s?k=adjustable+weight+bench+foldable&tag=dumblifts-20" target="_blank" rel="noopener">Shop</a>
    </div>
    <div class="gear-item">
      <span class="gear-icon">üß±</span>
      <div class="gear-info">
        <div class="gear-name">Exercise Floor Mat</div>
        <div class="gear-desc">Protects your floor and your back for floor press and stretching.</div>
      </div>
      <a class="gear-link" href="https://www.amazon.com/s?k=thick+exercise+mat+home+gym&tag=dumblifts-20" target="_blank" rel="noopener">Shop</a>
    </div>
  </div>`;

  // Info cards
  html += `
    <div class="info-card">
      <h3>Schedule</h3>
      <p>3 days per week, alternating workouts. Rest at least one day between sessions.</p>
    </div>
    <div class="info-card">
      <h3>Progression</h3>
      <p>With fixed dumbbells (5 lb jumps per dumbbell), stay at your current weight until 5√ó5 feels solid, even hitting 5√ó6 or 5√ó7. Then jump to the next dumbbell. You might only get 5√ó3 at the new weight. That's fine. Build back to 5√ó5 over a few sessions.</p>
    </div>
    <div class="info-card">
      <h3>Rest Between Sets</h3>
      <p>90 seconds when weights are light. 3 to 5 minutes as they get heavy. No rush.</p>
    </div>
    <div class="info-card">
      <h3>Warmup</h3>
      <p>Before each exercise: 1√ó5 with very light weight, then 1√ó5 at ~50% of your working weight. Then hit your 5 working sets.</p>
    </div>
    <div class="info-card">
      <h3>Exercise Tips</h3>
      <ul>
        <li><strong>Goblet Squat</strong> Hold one dumbbell vertically at your chest. Squat deep.</li>
        <li><strong>Bench Press</strong> Flat bench, press dumbbells up together.</li>
        <li><strong>Row</strong> Bent-over, one arm at a time or both. Pull to hip.</li>
        <li><strong>Romanian Deadlift</strong> Slight knee bend, hinge at hips, feel the hamstrings.</li>
        <li><strong>Overhead Press</strong> Standing or seated. Press straight up.</li>
        <li><strong>Floor Press</strong> Lie on the floor, press up. Tricep-focused bench variant.</li>
      </ul>
    </div>
    <div class="info-card">
      <h3>Deload Protocol</h3>
      <p>If you fail to get 5√ó5 at a weight for 3 consecutive sessions, drop down 10% and build back up. This is normal and part of the process.</p>
    </div>`;

  html += '<button class="reset-btn" onclick="resetAll()">Reset All Data</button>';

  sec.innerHTML = html;
}

// ‚îÄ‚îÄ Edit Workout Sub-View ‚îÄ‚îÄ
function renderEditWorkout() {
  const sec = document.getElementById('sec-program');
  const isNew = editNewWorkoutId !== null;
  const label = isNew ? 'Workout ' + editNewWorkoutId : state.program[editingWorkoutIdx].label;

  let html = `<div class="edit-header">
    <button class="edit-back-btn" onclick="cancelEdit()">‚Üê Back</button>
    <span>${isNew ? 'New' : 'Edit'} ${label}</span>
  </div>`;

  // Selected exercises
  html += `<div class="edit-section-label">Selected (${editSelectedIds.length}/3)</div>`;
  if (editSelectedIds.length > 0) {
    html += '<div class="edit-selected">';
    editSelectedIds.forEach(eid => {
      const lib = EXERCISE_LIBRARY.find(e => e.id === eid);
      if (lib) {
        html += `<div class="edit-selected-item">
          <span>${lib.name}</span>
          <button class="edit-remove-btn" onclick="editToggleExercise('${eid}')">√ó</button>
        </div>`;
      }
    });
    html += '</div>';
  }

  // Exercise library by group
  const atCapacity = editSelectedIds.length >= 3;
  const groupOrder = ['legs', 'push', 'pull'];
  const groupLabels = { legs: 'Legs', push: 'Push', pull: 'Pull' };

  if (atCapacity) {
    html += '<div class="edit-hint">Remove an exercise to swap</div>';
  }

  groupOrder.forEach(group => {
    html += `<div class="exercise-group-header">${groupLabels[group]}</div>`;
    EXERCISE_LIBRARY.filter(e => e.group === group).forEach(ex => {
      const selected = editSelectedIds.includes(ex.id);
      const disabled = atCapacity && !selected;
      html += `<button class="exercise-option ${selected ? 'selected' : ''} ${disabled ? 'disabled' : ''}" ${disabled ? '' : `onclick="editToggleExercise('${ex.id}')"`}>
        ${ex.name}${selected ? ' ‚úì' : ''}
      </button>`;
    });
  });

  // Save / Cancel
  const canSave = editSelectedIds.length === 3;
  html += `<button class="complete-btn ${canSave ? 'ready' : ''}" onclick="${canSave ? 'saveEditWorkout()' : ''}" ${canSave ? '' : 'disabled'} style="margin-top:20px;">
    ${canSave ? 'Save Workout' : 'Select 3 Exercises'}
  </button>`;
  html += `<button class="add-workout-btn cancel-btn" onclick="cancelEdit()" style="margin-top:10px;">Cancel</button>`;

  sec.innerHTML = html;
}

// ‚îÄ‚îÄ Actions ‚îÄ‚îÄ
function toggleSet(exId, setIndex) {
  const current = state.currentSets[exId][setIndex];
  // First tap = 5, then cycle down: 4 ‚Üí 3 ‚Üí 2 ‚Üí 1 ‚Üí 0
  const next = current === 0 ? 5 : current - 1;
  state.currentSets[exId][setIndex] = next;
  saveState();
  renderWorkout();

  // Start rest timer only on initial mark-done (0 ‚Üí 5)
  // and not when it's the last set of the exercise
  if (current === 0 && next === 5) {
    const allDone = state.currentSets[exId].every(v => v > 0);
    if (!allDone) {
      startRestTimer(90);
    }
  }
}

function changeWeight(exId, delta) {
  state.weights[exId] = Math.max(5, state.weights[exId] + delta);
  saveState();
  renderWorkout();
}

function completeWorkout() {
  const wo = WORKOUTS[state.nextWorkout];
  const entry = {
    date: new Date().toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' }),
    type: wo.label,
    exercises: wo.exercises.map(ex => ({
      name: ex.name,
      weight: state.weights[ex.id],
      unit: ex.unit,
      sets: [...state.currentSets[ex.id]]
    }))
  };
  state.history.push(entry);
  state.totalWorkouts++;

  // Reset sets
  wo.exercises.forEach(ex => {
    state.currentSets[ex.id] = [0, 0, 0, 0, 0];
  });

  // Cycle to next workout
  const ids = state.program.map(p => p.id);
  const curIdx = ids.indexOf(state.nextWorkout);
  state.nextWorkout = ids[(curIdx + 1) % ids.length];

  saveState();
  renderWorkout();
  showToast('Workout logged! üí™');
}

function resetAll() {
  if (confirm('Reset all DumbLifts data? This clears your history, weights, and progress.')) {
    state = defaultState();
    buildWorkouts();
    saveState();
    renderWorkout();
    renderHistory();
    renderStats();
    showToast('Data reset');
  }
}

// ‚îÄ‚îÄ Program Actions ‚îÄ‚îÄ
function editWorkout(idx) {
  editingWorkoutIdx = idx;
  editNewWorkoutId = null;
  editSelectedIds = [...state.program[idx].exerciseIds];
  renderEditWorkout();
}

function addWorkout() {
  const usedIds = state.program.map(p => p.id);
  const nextId = ['A', 'B', 'C', 'D'].find(id => !usedIds.includes(id));
  if (!nextId) return;

  editingWorkoutIdx = state.program.length;
  editNewWorkoutId = nextId;
  editSelectedIds = [];
  renderEditWorkout();
}

function editToggleExercise(eid) {
  const idx = editSelectedIds.indexOf(eid);
  if (idx >= 0) {
    editSelectedIds.splice(idx, 1);
  } else if (editSelectedIds.length < 3) {
    editSelectedIds.push(eid);
  }
  renderEditWorkout();
}

function saveEditWorkout() {
  if (editSelectedIds.length !== 3) return;

  if (editNewWorkoutId) {
    // Adding new workout
    state.program.push({
      id: editNewWorkoutId,
      label: 'Workout ' + editNewWorkoutId,
      exerciseIds: [...editSelectedIds]
    });
  } else {
    // Editing existing
    state.program[editingWorkoutIdx].exerciseIds = [...editSelectedIds];
  }

  // Init weights for new exercises
  editSelectedIds.forEach(eid => {
    if (state.weights[eid] === undefined) {
      const lib = EXERCISE_LIBRARY.find(e => e.id === eid);
      if (lib) state.weights[eid] = lib.defaultWeight;
    }
  });

  // Clear currentSets for this workout's exercises
  editSelectedIds.forEach(eid => {
    state.currentSets[eid] = [0, 0, 0, 0, 0];
  });

  buildWorkouts();
  saveState();
  editingWorkoutIdx = null;
  editNewWorkoutId = null;
  editSelectedIds = [];
  renderProgram();
}

function cancelEdit() {
  editingWorkoutIdx = null;
  editNewWorkoutId = null;
  editSelectedIds = [];
  renderProgram();
}

function removeWorkout(idx) {
  if (state.program.length <= 2) return;
  const pw = state.program[idx];
  if (!confirm(`Remove ${pw.label}? This cannot be undone.`)) return;

  state.program.splice(idx, 1);

  // Clean up currentSets for orphaned exercises
  const usedIds = new Set();
  state.program.forEach(p => p.exerciseIds.forEach(id => usedIds.add(id)));
  Object.keys(state.currentSets).forEach(id => {
    if (!usedIds.has(id)) delete state.currentSets[id];
  });

  // Fix nextWorkout if it was the removed workout
  const ids = state.program.map(p => p.id);
  if (!ids.includes(state.nextWorkout)) {
    state.nextWorkout = ids[0];
  }

  buildWorkouts();
  saveState();
  renderProgram();
}

function restoreDefault() {
  if (!confirm('Restore default A/B program? This resets your workout configuration but keeps your history.')) return;

  state.program = JSON.parse(JSON.stringify(DEFAULT_PROGRAM));

  // Re-init weights from defaults
  state.program.forEach(pw => {
    pw.exerciseIds.forEach(eid => {
      const lib = EXERCISE_LIBRARY.find(e => e.id === eid);
      if (lib) state.weights[eid] = lib.defaultWeight;
    });
  });

  state.currentSets = {};
  state.nextWorkout = 'A';

  buildWorkouts();
  saveState();
  renderProgram();
  showToast('Default program restored');
}

// ‚îÄ‚îÄ Data Export/Import ‚îÄ‚îÄ
function exportData() {
  const json = JSON.stringify(state, null, 2);
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const date = new Date().toISOString().slice(0, 10);
  a.href = url;
  a.download = `dumblifts-backup-${date}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  showToast('Data exported');
}

function importData() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  input.onchange = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
      try {
        const data = JSON.parse(ev.target.result);
        const required = ['weights', 'history', 'program', 'totalWorkouts', 'nextWorkout'];
        const missing = required.filter(k => !(k in data));
        if (missing.length) {
          showToast('Invalid backup file');
          return;
        }
        if (!confirm('Import data? This will replace your current data.')) return;
        state = data;
        migrateCurrentSets(state);
        buildWorkouts();
        saveState();
        renderWorkout();
        renderHistory();
        renderStats();
        renderProgram();
        showToast('Data imported');
      } catch (err) {
        showToast('Error reading file');
      }
    };
    reader.readAsText(file);
  };
  input.click();
}

// ‚îÄ‚îÄ Rest Timer ‚îÄ‚îÄ
function startRestTimer(seconds) {
  clearRestTimer();
  restTimeLeft = seconds;
  const total = seconds;
  updateRestTimerDisplay(total);
  document.getElementById('restTimer').classList.add('active');

  restTimer = setInterval(() => {
    restTimeLeft--;
    if (restTimeLeft <= 0) {
      clearRestTimer();
    } else {
      updateRestTimerDisplay(total);
    }
  }, 1000);
}

function updateRestTimerDisplay(total) {
  const el = document.getElementById('restTimer');
  const min = Math.floor(restTimeLeft / 60);
  const sec = restTimeLeft % 60;
  const pct = (restTimeLeft / total) * 100;
  el.innerHTML = `
    <div class="rest-timer-bar" style="width:${pct}%"></div>
    <div class="rest-timer-text">
      <span class="rest-timer-time">${min}:${sec.toString().padStart(2, '0')}</span>
      <span class="rest-timer-hint">tap to dismiss</span>
    </div>`;
}

function clearRestTimer() {
  if (restTimer) clearInterval(restTimer);
  restTimer = null;
  restTimeLeft = 0;
  document.getElementById('restTimer').classList.remove('active');
}

// ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ
function showSection(name) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(`sec-${name}`).classList.add('active');
  document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
  event.currentTarget.classList.add('active');

  if (name === 'workout') renderWorkout();
  if (name === 'history') renderHistory();
  if (name === 'stats') renderStats();
  if (name === 'program') renderProgram();
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2200);
}

// ‚îÄ‚îÄ Auth & Sync ‚îÄ‚îÄ
let firestoreDebounceTimer = null;

function syncToFirestore() {
  if (!auth.currentUser) return;
  clearTimeout(firestoreDebounceTimer);
  firestoreDebounceTimer = setTimeout(() => {
    const uid = auth.currentUser.uid;
    db.collection('users').doc(uid).set({
      ...state,
      lastModified: firebase.firestore.FieldValue.serverTimestamp()
    }).catch(err => console.log('Firestore sync error:', err));
  }, 300);
}

function loadFromFirestore(uid) {
  return db.collection('users').doc(uid).get().then(doc => {
    if (doc.exists) {
      const data = doc.data();
      delete data.lastModified;
      return data;
    }
    return null;
  });
}

function reRenderAll() {
  buildWorkouts();
  renderWorkout();
  renderHistory();
  renderStats();
}

function handleAuthStateChange(user) {
  renderAuthBar();
  if (!user) return;

  loadFromFirestore(user.uid).then(cloudData => {
    if (!cloudData) {
      // No cloud data ‚Äî upload local state
      syncToFirestore();
      return;
    }

    const localIsEmpty = state.totalWorkouts === 0 && state.history.length === 0;
    if (localIsEmpty) {
      // Local is fresh ‚Äî use cloud data
      state = cloudData;
      if (!state.program) state.program = JSON.parse(JSON.stringify(DEFAULT_PROGRAM));
      migrateCurrentSets(state);
      saveState();
      reRenderAll();
      showToast('Data loaded from cloud');
      return;
    }

    const cloudIsEmpty = cloudData.totalWorkouts === 0 && cloudData.history.length === 0;
    if (cloudIsEmpty) {
      // Cloud is empty ‚Äî upload local
      syncToFirestore();
      return;
    }

    // Both have data ‚Äî ask user
    if (confirm('Cloud data found (' + cloudData.totalWorkouts + ' workouts). Use cloud data? Cancel to keep local data and overwrite cloud.')) {
      state = cloudData;
      if (!state.program) state.program = JSON.parse(JSON.stringify(DEFAULT_PROGRAM));
      migrateCurrentSets(state);
      localStorage.setItem('dumblifts', JSON.stringify(state));
      reRenderAll();
      showToast('Cloud data loaded');
    } else {
      syncToFirestore();
      showToast('Local data kept');
    }
  }).catch(err => console.log('Firestore load error:', err));
}

function renderAuthBar() {
  const bar = document.getElementById('auth-bar');
  if (!bar) return;
  const user = auth.currentUser;
  if (user) {
    const photo = user.photoURL ? `<img class="auth-user-photo" src="${user.photoURL}" alt="" referrerpolicy="no-referrer">` : '';
    const name = user.displayName || user.email || '';
    bar.innerHTML = `<div class="auth-user-info">
      ${photo}
      <span class="auth-user-name">${name}</span>
      <button class="auth-signout-btn" onclick="signOutUser()">Sign out</button>
    </div>`;
  } else {
    bar.innerHTML = `<button class="auth-signin-btn" onclick="signInUser()">Sign in with Google</button>`;
  }
}

function signInUser() {
  const provider = new firebase.auth.GoogleAuthProvider();
  // Use redirect in standalone/PWA mode (iOS blocks popups in standalone)
  const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
  if (isStandalone) {
    auth.signInWithRedirect(provider);
  } else {
    auth.signInWithPopup(provider).catch(err => {
      if (err.code === 'auth/popup-blocked') {
        auth.signInWithRedirect(provider);
      } else {
        console.log('Sign in error:', err);
        showToast('Sign in failed');
      }
    });
  }
}

function signOutUser() {
  auth.signOut().then(() => {
    renderAuthBar();
    showToast('Signed out');
  });
}

auth.onAuthStateChanged(handleAuthStateChange);

// ‚îÄ‚îÄ Welcome Overlay ‚îÄ‚îÄ
function dismissWelcome() {
  document.getElementById('welcomeOverlay').style.display = 'none';
  localStorage.setItem('dumblifts-welcomed', '1');
}

if (!localStorage.getItem('dumblifts-welcomed')) {
  document.getElementById('welcomeOverlay').style.display = 'flex';
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
renderWorkout();

// ‚îÄ‚îÄ Register Service Worker ‚îÄ‚îÄ
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js')
    .then(reg => console.log('SW registered:', reg.scope))
    .catch(err => console.log('SW registration failed:', err));
}
</script>
</body>
</html>
